<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<title>view-source</title>
<style>
  body{margin:0;padding:0;background:#1e1e1e;font-family:system-ui;color:#d4d4d4}
  #bar{position:fixed;top:0;left:0;right:0;padding:1.5rem;background:#252526;text-align:center;z-index:9;box-shadow:0 4px 12px rgba(0,0,0,.4)}
  input{width:70%;max-width:720px;padding:14px;font-size:1.1rem;border:none;border-radius:8px;background:#3c3c3c;color:#fff}
  button{padding:14px 28px;margin-left:12px;background:#007acc;color:#fff;border:none;border-radius:8px;font-size:1.1rem;cursor:pointer}
  button:hover{background:#005a9e}
  pre{margin:0;padding:3rem 3rem 6rem;white-space:pre-wrap;word-wrap:break-word;word-break:break-all;overflow-wrap:anywhere;font-size:15.5px;line-height:1.65;background:#252526;color:#d4d4d4}
  #box{margin-top:90px;display:none}
  .loading{text-align:center;padding:5rem;font-size:1.4rem;color:#58a6ff}
  .error{color:#f48771;text-align:center;padding:3rem}
</style>
</head>
<body>

<div id="bar">
  <input id="i" placeholder="https://example.com" autofocus>
  <button onclick="go()">Go</button>
</div>

<div id="box">
  <pre id="out"></pre>
</div>

<script>
const params = new URLSearchParams(location.search);
const u = params.get('url');
if (u) { document.getElementById('i').value = u; go(u); }

async function go(custom) {
  let url = custom || document.getElementById('i').value.trim();
  if (!url) return;
  if (!/^https?:\/\//i.test(url)) url = 'https://' + url;

  const box = document.getElementById('box');
  const out = document.getElementById('out');
  out.textContent = 'loading...';
  box.style.display = 'block';

  try {
    const r = await fetch(url);
    if (!r.ok) throw new Error(r.status);
    let text = await r.text();

    // Simple but perfect escaping
    text = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

    out.innerHTML = text;
    document.title = new URL(url).hostname;
  } catch (e) {
    out.innerHTML = `<span class="error">failed â€” ${e.message}<br><br>Many sites block direct fetch (CORS).<br>Use a proxy service or open<br>view-source:${url}<br>in your browser address bar instead.</span>`;
  }
}

document.getElementById('i').addEventListener('keypress', e => {
  if (e.key === 'Enter') go();
});
</script>
</body>
</html>
