<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Minna no Nihongo Grammar - N4 Lessons</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      color: #333;
    }

    .wrapper {
      display: flex;
      min-height: 100vh;
      gap: 20px;
      padding: 20px;
      box-sizing: border-box;
    }

    .main-content,
    .sidebar {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      padding: 32px 28px;
      color: #2c3e50;
    }

    .main-content {
      flex: 2;
      max-width: 920px;
    }

    .sidebar {
      flex: 1;
      max-width: 340px;
      position: sticky;
      top: 20px;
      height: fit-content;
    }

    .sidebar h3 {
      margin: 0 0 1.4em 0;
      padding-bottom: 0.8em;
      border-bottom: 2px solid #3498db;
      color: #2980b9;
      font-size: 1.4em;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar li {
      margin: 0.6em 0;
    }

    .sidebar a {
      color: #34495e;
      text-decoration: none;
      display: block;
      padding: 10px 14px;
      border-radius: 8px;
      transition: all 0.2s;
      font-size: 1.05em;
    }

    .sidebar a:hover,
    .sidebar a.active {
      background: #ecf0f1;
      color: #2980b9;
      font-weight: 500;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin: 0 0 0.6em 0;
    }

    h2 {
      color: #2980b9;
      border-bottom: 2px solid #3498db;
      padding-bottom: 0.6em;
      margin: 2em 0 0.8em 0;
    }

    h3, h4 {
      color: #2c3e50;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.4em 0;
    }

    th, td {
      border: 1px solid #e0e0e0;
      padding: 12px;
      text-align: left;
    }

    th {
      background-color: #3498db;
      color: white;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .example {
      margin: 1.2em 0;
      padding: 16px;
      background: #f8fafc;
      border-left: 5px solid #3498db;
      border-radius: 6px;
    }

    .jp {
      font-size: 1.35em;
      font-weight: bold;
      color: #c0392b;
      margin-bottom: 0.4em;
    }

    .romaji {
      color: #7f8c8d;
      font-style: italic;
      margin-bottom: 0.5em;
    }

    .loading, .error {
      text-align: center;
      font-size: 1.3em;
      padding: 4em 1em;
      color: #7f8c8d;
    }

    .api-info {
      text-align: center;
      color: #7f8c8d;
      font-size: 0.95em;
      margin-bottom: 2em;
    }

    @media (max-width: 1024px) {
      .wrapper {
        flex-direction: column;
        padding: 16px;
      }
      
      .main-content,
      .sidebar {
        max-width: 100%;
      }
      
      .sidebar {
        position: static;
        order: -1;
      }
    }
  </style>
</head>
<body>

<div class="wrapper">

  <!-- Main Content (≈2/3) -->
  <div class="main-content">
    <h1>Minna no Nihongo Grammar (N4)</h1>
    <div class="api-info">
      Data from: <code>https://www.singhyogendra.com.np/lol/grammar/data.json</code>
    </div>

    <div id="loading" class="loading">Loading grammar data...</div>
    <div id="error" class="error" style="display:none;"></div>
    <div id="content" style="display:none;"></div>
  </div>

  <!-- Sidebar (≈1/3) -->
  <div class="sidebar">
    <h3>Lessons</h3>
    <ul id="lesson-links"></ul>
  </div>

</div>

<script>
  const apiUrl = 'https://www.singhyogendra.com.np/lol/grammar/data.json';

  fetch(apiUrl)
    .then(response => {
      if (!response.ok) throw new Error('Failed to load data');
      return response.json();
    })
    .then(data => {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('content').style.display = 'block';

      let html = '';
      let sidebarHtml = '';

      data.forEach(lesson => {
        const lessonId = `lesson-${lesson.lesson}`;

        sidebarHtml += `
          <li>
            <a href="#${lessonId}" data-lesson-id="${lessonId}">
              Lesson ${lesson.lesson}
            </a>
          </li>
        `;

        html += `
          <div class="lesson" id="${lessonId}">
            <h2>Lesson ${lesson.lesson}: ${lesson.title}</h2>
            <p><strong>Level:</strong> ${lesson.level}</p>

            <h3>Connection Structure</h3>
        `;

        if (lesson.connection_structure?.verbs) {
          html += `<h4>Verbs - ${lesson.connection_structure.verbs.form}</h4>`;
          html += '<table><tr><th>Base</th><th>Example</th><th>Result</th></tr>';
          lesson.connection_structure.verbs.rules.forEach(rule => {
            html += `<tr><td>${rule.base}</td><td>${rule.example}</td><td>${rule.plus_ndesu || rule.potential || '-'}</td></tr>`;
          });
          html += '</table>';
        }

        Object.keys(lesson.connection_structure || {}).forEach(key => {
          if (key !== 'verbs') {
            const section = lesson.connection_structure[key];
            const title = key.replace(/_/g, ' ')
              .split(' ')
              .map(w => w[0].toUpperCase() + w.slice(1))
              .join(' ');
            html += `<h4>${title} ${section.form ? '- ' + section.form : ''}</h4>`;
            if (section.rules) {
              html += '<table><tr><th>Base</th><th>Example</th><th>Result</th></tr>';
              section.rules.forEach(rule => {
                html += `<tr><td>${rule.base}</td><td>${rule.example}</td><td>${rule.plus_ndesu || rule.potential_shift || '-'}</td></tr>`;
              });
              html += '</table>';
            }
          }
        });

        html += '<h3>Grammar Points</h3>';
        lesson.grammar_points.forEach(point => {
          html += `
            <div class="example">
              <h4>${point.point}</h4>
              <p><strong>Meaning:</strong> ${point.meaning}</p>
            </div>
          `;
          if (point.examples?.length) {
            point.examples.forEach(ex => {
              html += `
                <div class="example">
                  <div class="jp">${ex.jp}</div>
                  <div class="romaji">${ex.romaji}</div>
                  <div><strong>English:</strong> ${ex.en}</div>
                </div>
              `;
            });
          }
        });

        html += '</div>';
      });

      document.getElementById('content').innerHTML = html;
      document.getElementById('lesson-links').innerHTML = sidebarHtml;

      // Smooth scroll & active state
      document.querySelectorAll('.sidebar a').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const targetId = this.getAttribute('href').substring(1);
          document.getElementById(targetId)?.scrollIntoView({ behavior: 'smooth' });

          document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
          this.classList.add('active');
        });
      });

      document.querySelector('.sidebar a')?.classList.add('active');
    })
    .catch(err => {
      document.getElementById('loading').style.display = 'none';
      const errorEl = document.getElementById('error');
      errorEl.style.display = 'block';
      errorEl.textContent = 'Error loading data: ' + err.message;
    });
</script>

</body>
</html>
